---
phase: 04-results-and-explainability
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/features/results/components/AdaptiveVisual.tsx
  - src/features/results/components/ExplainabilityControls.tsx
  - src/features/results/components/WhyBreakdownModal.tsx
autonomous: true
must_haves:
  truths:
    - "User sees criteria-count adaptive visuals: radar (>=3), dial (2), comparison bar (1)."
    - "User can hover/focus options across visual surfaces with non-focused options moderately dimmed."
    - "User can inspect per-criterion desirability in visual hover details, with optional raw values when the global toggle is enabled."
    - "User can open compact why details and close via X or backdrop click."
    - "User sees one global raw/desirability toggle only when measured criteria exist."
  artifacts:
    - path: "src/features/results/components/AdaptiveVisual.tsx"
      provides: "Criteria-count visual router with radar, dial, and bar variants plus hover detail payload rendering"
      contains: "RadarChart|Gauge|BarChart"
    - path: "src/features/results/components/ExplainabilityControls.tsx"
      provides: "Global controls for focus mode and conditional raw/desirability toggle"
      contains: "showRawInputs"
    - path: "src/features/results/components/WhyBreakdownModal.tsx"
      provides: "Compact contribution modal with explicit and backdrop close"
      contains: "Dialog.Close"
  key_links:
    - from: "src/features/results/components/AdaptiveVisual.tsx"
      to: "src/features/results/state/results.selectors.ts"
      via: "visual series and criteria metadata payload"
      pattern: "visualModel"
    - from: "src/features/results/components/ExplainabilityControls.tsx"
      to: "src/features/results/components/AdaptiveVisual.tsx"
      via: "shared showRawInputs contract used by visual hover-detail rows"
      pattern: "showRawInputs"
    - from: "src/features/results/components/WhyBreakdownModal.tsx"
      to: "src/features/results/state/results.types.ts"
      via: "typed weighted contribution entries"
      pattern: "contributions"
---

<objective>
Build the adaptive chart + explainability interaction layer for Phase 4 results.

Purpose: Let users interpret why options rank as they do through context-aware visuals and low-friction interactive detail inspection.
Output: Adaptive visual component, explainability controls, and compact why modal driven by shared result payloads.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-results-and-explainability/04-CONTEXT.md
@.planning/phases/04-results-and-explainability/04-RESEARCH.md
@src/features/results/state/results.types.ts
@src/features/results/state/results.selectors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement criteria-count adaptive visual renderer</name>
  <files>src/features/results/components/AdaptiveVisual.tsx</files>
  <action>Build one adaptive visual component using MUI X Charts primitives: radar for >=3 criteria, gauge/dial for exactly 2, and horizontal comparison bar for exactly 1 criterion. For radar, render lines only (no area fill), use distinct option colors with slight rank-based positive brightness tendency, and draw higher-ranked option lines above lower-ranked lines. Add visual hover/focus inspection details that show criterion-level desirability values for the active option and include criterion raw values only when `showRawInputs` is true and raw data exists. Keep animation expressive while respecting reduced-motion via chart `skipAnimation`/equivalent control.</action>
  <verify>bun run lint</verify>
  <done>Adaptive visual component satisfies RES-04/05/06/07 with locked style rules (radar no fill, rank-based draw order, preserved ranking order in bar fallback, hover details include criterion desirability and conditional raw values).</done>
</task>

<task type="auto">
  <name>Task 2: Implement linked explainability controls</name>
  <files>src/features/results/components/ExplainabilityControls.tsx</files>
  <action>Create controls for linked hover/focus behavior and a single global raw/desirability toggle placed near explainability controls. Ensure the raw toggle only renders when measured criteria are present, and focus mode semantics represent moderate dimming for non-focused options (state contract only in this task; visual styling lands in integration plan). Define the toggle contract so `showRawInputs` is wired by `ResultsStep` into both `AdaptiveVisual` hover details and why modal content in 04-04 integration.</action>
  <verify>bun run lint</verify>
  <done>Controls expose typed state-change callbacks for hover/focus/raw-display behavior and hide raw toggle when no measured criteria exist (RES-07/08/11).</done>
</task>

<task type="auto">
  <name>Task 3: Implement compact why-contribution modal</name>
  <files>src/features/results/components/WhyBreakdownModal.tsx</files>
  <action>Build a compact, easy-to-digest why modal using `@base-ui/react` Dialog primitives. Render weighted contribution breakdown rows (criterion desirability, weight, contribution, optional raw when toggle is on), and ensure close behavior supports explicit `X` control plus backdrop click. Keep wording utilitarian and concise.</action>
  <verify>bun run lint && bun run build</verify>
  <done>Why modal opens with typed contribution content and closes through both required interaction paths while matching RES-10/11 and locked interaction decisions.</done>
</task>

</tasks>

<verification>
With selector payload fixtures for 1, 2, and 3+ criteria, confirm each fallback renders the correct visual mode and the modal/toggle controls behave as specified.
</verification>

<success_criteria>
Adaptive visual and explainability interaction components satisfy RES-04/05/06/07/08/10/11 using approved chart/dialog libraries and locked behavior rules.
</success_criteria>

<output>
After completion, create `.planning/phases/04-results-and-explainability/04-03-SUMMARY.md`
</output>
