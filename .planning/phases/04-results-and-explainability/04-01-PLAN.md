---
phase: 04-results-and-explainability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bun.lock
  - src/features/results/results.schema.ts
  - src/features/results/state/results.types.ts
  - src/features/results/state/results.selectors.ts
autonomous: true
must_haves:
  truths:
    - "User sees WSM as the default ranking method with deterministic rank and score ordering."
    - "User sees WPM strict-check status based on the same underlying ratings and weights data."
    - "Ranking ties display using shared-rank numbering (1, 1, 3)."
  artifacts:
    - path: "src/features/results/state/results.selectors.ts"
      provides: "WSM/WPM projections, tie ranking, contribution and coverage view models"
      exports: ["selectResultsProjection", "selectMethodCheck", "selectRankingRows"]
    - path: "src/features/results/state/results.types.ts"
      provides: "Typed contracts for ranking rows, strict-check status, and explainability payloads"
      contains: "export type RankingRow"
    - path: "src/features/results/results.schema.ts"
      provides: "Shared result-domain constants and guardable schema constraints"
      contains: "RESULTS_DOMAIN_CONSTANTS"
  key_links:
    - from: "src/features/results/state/results.selectors.ts"
      to: "src/features/ratings/state/rating.selectors.ts"
      via: "reuse of desirability/coverage selectors without new imputation"
      pattern: "selectCellDesirability"
    - from: "src/features/results/state/results.selectors.ts"
      to: "src/features/results/state/results.types.ts"
      via: "typed selector outputs consumed by all result UI components"
      pattern: "RankingRow|MethodCheck"
---

<objective>
Create the canonical results projection layer so every Phase 4 view (table, strict-check panel, charts, and why details) renders from one deterministic source of truth.

Purpose: Prevent trust-breaking drift between WSM/WPM, coverage badges, and explainability outputs.
Output: Installed results UI dependencies plus typed selectors/schemas for rankings, strict checks, tie handling, and contribution payloads.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-results-and-explainability/04-CONTEXT.md
@.planning/phases/04-results-and-explainability/04-RESEARCH.md
@src/features/ratings/state/rating.selectors.ts
@src/features/ratings/state/rating.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install phase-approved visualization and explainability primitives</name>
  <files>package.json, bun.lock</files>
  <action>Install and lock `@mui/x-charts`, `@mui/material`, `@emotion/react`, `@emotion/styled`, and `@base-ui/react` using Bun exactly as recommended in 04-RESEARCH.md. Do not introduce alternate chart/modal libraries; use this stack per locked direction to avoid hand-rolled charting and dialog semantics.</action>
  <verify>bun add @mui/x-charts @mui/material @emotion/react @emotion/styled @base-ui/react && bun run lint</verify>
  <done>Dependency manifest and lockfile include the required packages with a passing typecheck/lint run.</done>
</task>

<task type="auto">
  <name>Task 2: Build selector-first results domain contracts</name>
  <files>src/features/results/results.schema.ts, src/features/results/state/results.types.ts, src/features/results/state/results.selectors.ts</files>
  <action>Create the `results` state layer that computes WSM default ranking, WPM strict-check ranking, shared-rank ties (1,1,3), weighted contribution breakdowns, and method agreement/difference metadata. Keep WSM primary in output contracts, compute WPM with strict positive normalization, and never silently impute missing ratings (reuse existing Phase 3 missing/coverage semantics). Include neutral difference-state payloads and expanded strict-check payloads that can show near-full WPM perspective with WSM callouts.</action>
  <verify>bun run lint && bun run build</verify>
  <done>Results selectors export typed view models for ranking table rows, strict-check panel states, and explainability payloads that satisfy RES-01/02/03/09/10 without duplicated UI math.</done>
</task>

</tasks>

<verification>
Confirm selectors return stable ranking order, shared tie ranks, and agreement/difference flags for the same draft input across repeated runs.
</verification>

<success_criteria>
Results math and display payloads are centralized in `src/features/results/state/results.selectors.ts`, WSM remains default, WPM strict-check data is available, and no component needs to recalculate scoring equations.
</success_criteria>

<output>
After completion, create `.planning/phases/04-results-and-explainability/04-01-SUMMARY.md`
</output>
