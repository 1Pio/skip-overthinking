---
phase: 05-persistence-auth-and-sync-security
plan: 03
type: execute
wave: 2
depends_on:
  - 05-01
files_modified:
  - src/features/auth/components/SignInModal.tsx
  - src/features/auth/components/SettingsModal.tsx
  - src/features/auth/components/AuthFooter.tsx
  - src/features/auth/components/index.ts
  - src/features/auth/auth.context.tsx
autonomous: true
requirements:
  - SYN-02
user_setup: []

must_haves:
  truths:
    - "User can see sign-in modal from anywhere by clicking auth status"
    - "User can sign in with Email, Google, or GitHub via clean, minimal buttons"
    - "User sees clear, compact statement of sign-in benefits"
    - "User can access settings modal to sign out or delete account"
    - "Footer shows current auth mode (local-only or authenticated) subtly"
    - "Modals can be dismissed by clicking outside or X button"
  artifacts:
    - path: "src/features/auth/components/SignInModal.tsx"
      provides: "Sign-in modal with auth buttons"
      contains: "SignInModal"
    - path: "src/features/auth/components/SettingsModal.tsx"
      provides: "Settings modal with sign-out and account deletion"
      contains: "SettingsModal"
    - path: "src/features/auth/components/AuthFooter.tsx"
      provides: "Footer showing current auth mode"
      contains: "AuthFooter"
    - path: "src/features/auth/auth.context.tsx"
      provides: "Auth context for managing auth state"
      contains: "AuthContext", "AuthProvider"
    - path: "src/features/auth/components/index.ts"
      provides: "Export all auth components"
  key_links:
    - from: "src/features/auth/components/SignInModal.tsx"
      to: "convex/auth"
      via: "Convex client auth methods"
      pattern: "useAuth\\(\\)"
    - from: "src/features/auth/components/SettingsModal.tsx"
      to: "convex/auth"
      via: "signOut and deleteAccount methods"
      pattern: "signOut\\(\\)|deleteAccount\\(\\)"
    - from: "src/features/auth/auth.context.tsx"
      to: "convex/auth"
      via: "useConvexAuth hook"
      pattern: "useConvexAuth"
    - from: "src/features/auth/components/AuthFooter.tsx"
      to: "src/features/auth/auth.context.tsx"
      via: "useAuth hook"
      pattern: "useAuth\\(\\)"
---

<objective>
Build auth UI components: sign-in modal, settings modal, and auth footer.

Purpose: Provide auth entry/switching UX (SYN-02) with effortless sign-in flow and subtle status display.
Output: Sign-in modal with Email/Google/GitHub buttons, settings modal with sign-out/delete, and footer showing auth mode.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth context with Convex integration</name>
  <files>
    - src/features/auth/auth.context.tsx
  </files>
  <action>
    Create src/features/auth/auth.context.tsx:

    1. Import useConvexAuth from "@convex-dev/react"

    2. Define AuthContext interface:
       - isAuthenticated: boolean (derived from isLoading and isAuthenticated)
       - isLoading: boolean
       - user: { id: string } | null (from Convex auth)
       - signIn: () => void (opens sign-in modal)
       - signOut: () => void (signs out from Convex)
       - isSignInModalOpen: boolean
       - openSignInModal: () => void
       - closeSignInModal: () => void
       - isSettingsModalOpen: boolean
       - openSettingsModal: () => void
       - closeSettingsModal: () => void
       - deleteAccount: () => Promise<void>

    3. Create AuthProvider component:
       - Call useConvexAuth() to get Convex auth state
       - Manage modal open/close state with useState
       - signIn() calls openSignInModal()
       - signOut() calls Convex's signOut()
       - deleteAccount() calls Convex's account deletion (if available) or handles via backend function

    4. Export AuthContext and AuthProvider

    IMPORTANT: This context wraps the app to provide auth state to all components. It integrates with Convex Auth for actual authentication.
  </action>
  <verify>
    - src/features/auth/auth.context.tsx exists
    - AuthContext interface is defined with all required properties
    - AuthProvider component uses useConvexAuth
    - Modal state is managed with useState
    - signIn/signOut/deleteAccount functions are implemented
  </verify>
  <done>
    Auth context provides Convex auth integration and modal state management.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create sign-in modal component</name>
  <files>
    - src/features/auth/components/SignInModal.tsx
  </files>
  <action>
    Create src/features/auth/components/SignInModal.tsx:

    1. Import useAuth from auth.context.tsx

    2. Component interface:
       - isOpen: boolean
       - onClose: () => void

    3. Modal layout:
       - Overlay backdrop (click outside to close)
       - Centered modal container
       - X button to close

    4. Modal content:
       - Above auth methods: Clear, compact header
         - Title: "Sign In" (or similar)
         - Subtitle: "Sign in to save your decisions across devices and access them from anywhere. 100% optional."
       - Auth buttons (clean, minimal, effortless):
         - Email button: "Continue with Email"
         - Google button: "Continue with Google"
         - GitHub button: "Continue with GitHub"
         - Each button triggers Convex auth method (use Convex's built-in auth triggers)
       - Below options: Expandable "Learn more" section
         - Small, slightly grayed out
         - Expand to show: "Decisions are stored in your account. Local-only decisions are not uploaded. Sign out to clear local cache."

    5. Styling:
       - Use Tailwind for layout
       - Minimal, clean design with good spacing
       - Buttons have hover states

    6. Clicking outside backdrop calls onClose()
    7. X button calls onClose()

    IMPORTANT: Sign-in is positioned as optional, quality-of-life upgrade. Keep messaging clear and non-pressuring.
  </action>
  <verify>
    - src/features/auth/components/SignInModal.tsx exists
    - Modal has overlay and centered container
    - Header shows clear, compact sign-in benefits
    - Email/Google/GitHub buttons are present
    - Expandable "Learn more" section exists
    - Click outside or X closes modal
    - Styling is clean and minimal
  </verify>
  <done>
    Sign-in modal provides effortless auth entry with clear benefits communication.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create settings modal component</name>
  <files>
    - src/features/auth/components/SettingsModal.tsx
  </files>
  <action>
    Create src/features/auth/components/SettingsModal.tsx:

    1. Import useAuth from auth.context.tsx

    2. Component interface:
       - isOpen: boolean
       - onClose: () => void

    3. Modal layout:
       - Overlay backdrop (click outside to close)
       - Centered modal container
       - X button to close

    4. Modal content:
       - Header: "Settings" title
       - Account section:
         - Placeholder icon for account (no name or picture per user decision)
         - Current email if available (from Convex auth)
       - Actions section:
         - Sign out button: "Sign Out"
         - Account deletion button: "Delete Account" (red/danger color)
       - Future section:
         - Note: "More settings coming soon" (for future style customization)

    5. Action behavior:
       - Sign out: Calls useAuth().signOut(), then onClose()
       - Delete account: Calls useAuth().deleteAccount(), shows confirmation first, then onClose()

    6. Styling:
       - Use Tailwind for layout
       - Sign out button is standard style
       - Delete account button uses red/danger color
       - Good spacing and clean design

    7. Clicking outside backdrop calls onClose()
    8. X button calls onClose()

    IMPORTANT: No account name or profile picture per user decision. Use placeholder icon.
  </action>
  <verify>
    - src/features/auth/components/SettingsModal.tsx exists
    - Modal has overlay and centered container
    - Placeholder icon is used for account
    - Sign out and delete account buttons exist
    - Delete account button uses red/danger color
    - Future settings note is present
    - Click outside or X closes modal
  </verify>
  <done>
    Settings modal provides sign-out and account deletion options.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create auth footer component</name>
  <files>
    - src/features/auth/components/AuthFooter.tsx
  </files>
  <action>
    Create src/features/auth/components/AuthFooter.tsx:

    1. Import useAuth from auth.context.tsx

    2. Footer content:
       - Fixed at bottom of screen or within decision pages (sticky footer area)
       - Subtle, unobtrusive design
       - Shows current auth mode:
         - If authenticated: "Signed in" (with small green indicator or similar)
         - If not authenticated: "Local-only" (with small gray indicator or similar)
       - Clicking footer opens sign-in modal (if not authenticated) or settings modal (if authenticated)

    3. Styling:
       - Use Tailwind for layout
       - Small text, muted colors
       - Subtle hover effect to indicate clickability
       - Fixed at bottom: `fixed bottom-0 w-full` or sticky within page content

    4. Behavior:
       - Click calls useAuth().openSignInModal() or openSettingsModal()
       - No persistent footer in workspace page (workspace has top-right auth button)

    IMPORTANT: Footer is subtle and unobtrusive. Status is communicated with small indicators, not prominent messaging.
  </action>
  <verify>
    - src/features/auth/components/AuthFooter.tsx exists
    - Footer shows current auth mode (signed in vs local-only)
    - Status is subtle with small indicators
    - Clicking opens appropriate modal
    - Styling is unobtrusive and clean
  </verify>
  <done>
    Auth footer shows current auth mode and provides access to auth modals.
  </done>
</task>

<task type="auto">
  <name>Task 5: Export all auth components</name>
  <files>
    - src/features/auth/components/index.ts
  </files>
  <action>
    Create src/features/auth/components/index.ts:

    Export all auth components:
    - SignInModal
    - SettingsModal
    - AuthFooter

    Also re-export types if any (e.g., component props interfaces).

    This creates a clean public API for consuming auth components.
  </action>
  <verify>
    - src/features/auth/components/index.ts exists
    - SignInModal is exported
    - SettingsModal is exported
    - AuthFooter is exported
  </verify>
  <done>
    Auth components are exported and ready for use in the app.
  </done>
</task>

</tasks>

<verification>
- Auth context integrates with Convex Auth for authentication
- Sign-in modal provides Email/Google/GitHub auth options with clear benefits
- Settings modal provides sign-out and account deletion options
- Auth footer subtly shows current auth mode
- All modals can be dismissed by clicking outside or X button
- Sign-in messaging is clear that it's optional and quality-of-life focused
</verification>

<success_criteria>
- User can sign in via Email, Google, or GitHub
- Sign-in modal clearly communicates optional nature and benefits
- Settings modal provides sign-out and account deletion
- Footer shows subtle auth status indicator
- All modals are accessible and dismissible
- Requirement SYN-02 is addressed with auth UX
</success_criteria>

<output>
After completion, create `.planning/phases/05-persistence-auth-and-sync-security/05-03-SUMMARY.md`
</output>
