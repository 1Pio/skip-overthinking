---
phase: 05-persistence-auth-and-sync-security
plan: 08
type: execute
wave: 3
depends_on:
  - 05-03
  - 05-04
  - 05-07
files_modified:
  - src/features/workspace/Workspace.tsx
  - src/features/workspace/index.ts
autonomous: false
requirements:
  - SYN-01
  - SYN-02
  - SYN-03
user_setup: []

must_haves:
  truths:
    - "Workspace page displays all decisions as cards (like projects)"
    - "User can view/edit existing decision from workspace"
    - "Sign-in/out button at top right of workspace page"
  artifacts:
    - path: "src/features/workspace/Workspace.tsx"
      provides: "Main workspace page with decision cards"
      contains: "Workspace"
    - path: "src/features/workspace/index.ts"
      provides: "Export workspace and hooks"
      exports: ["Workspace", "useMergeOnSignIn"]
  key_links:
    - from: "src/features/workspace/Workspace.tsx"
      to: "src/features/auth/auth.context.tsx"
      via: "useAuth hook for auth state"
      pattern: "useAuth\\(\\)"
    - from: "src/features/workspace/Workspace.tsx"
      to: "convex/decisions"
      via: "useQuery for loading authenticated decisions"
      pattern: "useQuery\\(.*decisions\\.list\\)"
---

<objective>
Create workspace page component with decision display and auth integration.

Purpose: Provide decision organization workspace (SYN-01, SYN-02, SYN-03) with auth state integration.
Output: Workspace page with decision cards, auth-aware data loading, and sign-in/sign-out buttons.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/features/auth/auth.context.tsx
@src/features/workspace/hooks/useMergeOnSignIn.ts
@src/features/workspace/DecisionCard.tsx
@src/features/workspace/NewDecisionButton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workspace page component</name>
  <files>
    - src/features/workspace/Workspace.tsx
  </files>
  <action>
    Create src/features/workspace/Workspace.tsx:

    1. Import useAuth from auth/auth.context.tsx
    2. Import useQuery from "@convex-dev/react"
    3. Import useMergeOnSignIn from "./hooks/useMergeOnSignIn"
    4. Import DecisionCard from "./DecisionCard"
    5. Import NewDecisionButton from "./NewDecisionButton"
    6. Import { useNavigate } from "react-router-dom"
    7. Import localStorageService from "../../auth/storage/local.storage.ts"

    2. Component structure:
       - Header:
         - Title: "Decisions" or similar
         - Right side: Sign-in/Settings button (opens settings modal if authenticated, sign-in modal if not)
       - Main content:
         - New decision button
         - Grid of decision cards

    3. Decision loading:
       - If authenticated: Load decisions from Convex: const decisions = useQuery(api.decisions.list)
       - If not authenticated: Load decisions from localStorage: const localDecisions = localStorageService.loadDecisions()
       - Display decisions in grid using DecisionCard component

    4. Call useMergeOnSignIn() to handle merge on sign-in

    5. Navigation:
       - Click on card: navigate to decision (e.g., /decision/{id} or restore to existing wizard flow)
       - Click on new decision: navigate to /setup/decision

    6. Sign-out handling:
       - Settings modal handles sign-out (from plan 03)
       - When sign-out is called: localStorageService.clearAll() (already handled by auth context)

    7. Empty state:
       - If no decisions: Show "No decisions yet. Create your first decision!" message

    IMPORTANT: Workspace is the new landing page where users manage all decisions. Sign-in/out button is at top right (different from footer in decision pages).
  </action>
  <verify>
    - src/features/workspace/Workspace.tsx exists
    - Header has title and sign-in/settings button at top right
    - New decision button is present
    - Decisions are displayed in grid
    - Authenticated users load from Convex, anonymous from localStorage
    - useMergeOnSignIn is called
    - Clicking card navigates to decision
    - Empty state message is shown when no decisions
  </verify>
  <done>
    Workspace page displays all decisions and provides navigation to create/view decisions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Workspace page with decision cards, merge logic on sign-in, and sign-in/sign-out buttons</what-built>
  <how-to-verify>
    1. Start the app: `bun run dev`
    2. Create a decision locally (don't sign in)
    3. Refresh page - verify decision persists
    4. Sign in via footer or workspace sign-in button
    5. Verify toast shows "1 decision merged into your account"
    6. Verify decision appears in workspace
    7. Create another decision while signed in
    8. Sign out via settings modal
    9. Verify local storage is cleared and decisions are gone
    10. Sign back in - verify decisions are still there (server preserved)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Export workspace components with hooks</name>
  <files>
    - src/features/workspace/index.ts
  </files>
  <action>
    Update src/features/workspace/index.ts:

    Export all workspace components and hooks:
    - Workspace
    - DecisionCard
    - NewDecisionButton
    - useMergeOnSignIn

    This creates a clean public API for consuming workspace components.
  </action>
  <verify>
    - src/features/workspace/index.ts exists
    - Workspace is exported
    - DecisionCard is exported
    - NewDecisionButton is exported
    - useMergeOnSignIn is exported
  </verify>
  <done>
    Workspace components and hooks are exported and ready for use.
  </done>
</task>

</tasks>

<verification>
- Workspace page displays decisions as cards in a grid
- New decision button creates new decisions
- Signing in merges local decisions with toast notification
- Signing out clears local storage
- Sign-in/sign-out buttons at top right of workspace
- Authenticated users load from Convex, anonymous from localStorage
- Empty state shows when no decisions
</verification>

<success_criteria>
- Workspace page is the new landing page
- Decisions are displayed as project-like cards
- Sign-in merges local decisions with notification
- Sign-out clears local cache
- All requirements SYN-01, SYN-02, SYN-03 are addressed
</success_criteria>

<output>
After completion, create `.planning/phases/05-persistence-auth-and-sync-security/05-08-SUMMARY.md`
</output>
