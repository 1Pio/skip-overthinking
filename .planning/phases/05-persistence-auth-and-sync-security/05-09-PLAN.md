---
phase: 05-persistence-auth-and-sync-security
plan: 09
type: execute
wave: 4
depends_on:
  - 05-03
  - 05-05
  - 05-08
files_modified:
  - src/app/App.tsx
  - src/app/router.tsx
autonomous: true
requirements:
  - SYN-01
  - SYN-02
user_setup: []

must_haves:
  truths:
    - "Auth state is available throughout the app"
    - "AuthFooter appears in decision pages (not workspace)"
    - "First app launch shows auth choice modal (optional, can sign in anytime)"
  artifacts:
    - path: "src/app/App.tsx"
      provides: "Main app with AuthProvider and router"
      contains: "App"
    - path: "src/app/router.tsx"
      provides: "Router with AuthFooter in wizard routes"
      contains: "createBrowserRouter"
  key_links:
    - from: "src/app/App.tsx"
      to: "src/features/auth/auth.context.tsx"
      via: "AuthProvider wrapping app"
      pattern: "<AuthProvider>"
    - from: "src/app/router.tsx"
      to: "src/features/auth/components/AuthFooter.tsx"
      via: "AuthFooter component in wizard routes"
      pattern: "<AuthFooter"
---

<objective>
Wrap app in AuthProvider, add AuthFooter to wizard routes, and add first launch modal.

Purpose: Complete auth integration (SYN-01, SYN-02) with app-wide auth context and footer placement.
Output: App wrapped in AuthProvider, AuthFooter in wizard routes, and first launch auth choice modal.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/features/auth/auth.context.tsx
@src/features/workspace/Workspace.tsx
@src/features/auth/components/AuthFooter.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap app in AuthProvider</name>
  <files>
    - src/app/App.tsx
  </files>
  <action>
    Update src/app/App.tsx:

    1. Import AuthProvider from "../features/auth/auth.context"

    2. Wrap the entire app in AuthProvider:
    - Existing: <RouterProvider router={router} />
    - Updated: <AuthProvider><RouterProvider router={router} /></AuthProvider>

    3. Keep existing DraftProvider (should remain inside RouterProvider)

    4. The structure should be:
    - AuthProvider (wraps everything for auth context)
      - RouterProvider
        - DraftProvider (already in routes)
          - Wizard routes, workspace, etc.

    IMPORTANT: AuthProvider must wrap RouterProvider so all routes have access to auth context.
  </action>
  <verify>
    - src/app/App.tsx imports AuthProvider
    - AuthProvider wraps RouterProvider
    - Auth context is available to all routes
    - DraftProvider remains in place within routes
  </verify>
  <done>
    App is wrapped in AuthProvider for auth context access.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add AuthFooter to wizard routes</name>
  <files>
    - src/app/router.tsx
  </files>
  <action>
    Add AuthFooter to wizard routes (not workspace):

    1. Import AuthFooter from "../features/auth/components/AuthFooter"

    2. Add AuthFooter to wizard routes in router.tsx:
    - /setup/decision
    - /setup/options
    - /criteria
    - /ratings
    - /results

    The AuthFooter should be placed at the bottom of these route elements.

    Example structure for a wizard route:
    - <RequireDecisionSetup>
      - <DraftProvider>
        - <DraftStep />
        - <AuthFooter />
      </DraftProvider>
    </RequireDecisionSetup>

    IMPORTANT: AuthFooter appears in decision pages (wizard routes) as a sticky footer. Workspace has top-right auth button instead.
  </action>
  <verify>
    - AuthFooter is imported
    - AuthFooter appears in wizard routes
    - AuthFooter does NOT appear in workspace route
  </verify>
  <done>
    AuthFooter appears in wizard routes with sticky footer placement.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add first launch auth choice modal</name>
  <files>
    - src/app/App.tsx
  </files>
  <action>
    Add first launch auth choice modal to App.tsx:

    1. Add state to track if user has seen auth choice modal:
    - useState for showAuthChoiceModal
    - Check localStorage for key: "skip-overthinking:auth-choice-seen:v1"

    2. On app mount (useEffect):
    - If key doesn't exist in localStorage: Show modal (set showAuthChoiceModal = true)
    - If key exists: Don't show modal

    3. Modal component (can reuse SignInModal or create simple dialog):
    - Clear, compact header: "Welcome to Skip Overthinking"
    - Body: "Sign in to save your decisions across devices, or continue locally. Your choice, anytime."
    - Two buttons:
      - "Continue Local" (closes modal, sets localStorage key)
      - "Sign In" (opens sign-in modal, sets localStorage key)

    4. When user makes choice:
    - Set localStorage key: localStorage.setItem("skip-overthinking:auth-choice-seen:v1", "true")
    - Close modal

    IMPORTANT: This is optional per user decision ("auth choice on first app launch"). The modal should be dismissible and not block app usage. Users can still sign in later via footer or workspace.
  </action>
  <verify>
    - App.tsx has first launch auth choice modal logic
    - Modal shows on first launch if localStorage key not set
    - Modal can be dismissed without signing in
    - Modal has "Continue Local" and "Sign In" options
    - localStorage key is set after choice
  </verify>
  <done>
    First launch auth choice modal is implemented.
  </done>
</task>

</tasks>

<verification>
- App is wrapped in AuthProvider
- AuthFooter appears in wizard routes (not workspace)
- First launch modal shows auth choice
- Modal can be dismissed without signing in
</verification>

<success_criteria>
- Auth context is available throughout app
- Users can sign in anytime via footer or workspace
- First launch shows optional auth choice modal
- All requirements SYN-01 and SYN-02 are fully integrated
</success_criteria>

<output>
After completion, create `.planning/phases/05-persistence-auth-and-sync-security/05-09-SUMMARY.md`
</output>
