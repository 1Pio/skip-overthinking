---
phase: 03-ratings-weights-and-coverage-integrity
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/features/ratings/components/RatingsStep.tsx
  - src/features/ratings/components/RatingsMatrix.tsx
  - src/features/ratings/components/RatingCell.tsx
  - src/features/ratings/components/RatingModeToggle.tsx
  - src/features/ratings/components/FillMissingReviewPanel.tsx
  - src/routes/ratings/RatingsRoute.tsx
  - src/styles.css
autonomous: true
must_haves:
  truths:
    - "User sees a compact spreadsheet-like matrix with sticky criterion headers and sticky option labels."
    - "Blank cells are visually intentional by default; filled cells are subtly tinted for fast scanning."
    - "User can toggle rating_1_20 mode near top-right and always sees a short helper line explaining behavior."
    - "User can preview and explicitly apply Fill all missing with Neutral (10) instead of automatic imputation."
    - "Ghost values are visible but slightly grayed so mapped inactive-mode values are understandable at a glance."
  artifacts:
    - path: "src/features/ratings/components/RatingsMatrix.tsx"
      provides: "Sticky-header matrix rendering across options and criteria"
      contains: "position: sticky"
    - path: "src/features/ratings/components/RatingModeToggle.tsx"
      provides: "Decision-level numeric vs seven-level mode toggle with helper copy"
      contains: "seven"
    - path: "src/features/ratings/components/FillMissingReviewPanel.tsx"
      provides: "Review-before-apply flow for explicit neutral fill"
      contains: "Neutral (10)"
    - path: "src/routes/ratings/RatingsRoute.tsx"
      provides: "Ratings route integration with matrix UI and guard-preserving flow"
      contains: "RatingsStep"
  key_links:
    - from: "src/features/ratings/components/RatingsStep.tsx"
      to: "src/features/ratings/state/rating.selectors.ts"
      via: "derived missing-count and completion selectors"
      pattern: "missing"
    - from: "src/features/ratings/components/RatingCell.tsx"
      to: "src/features/ratings/state/rating.actions.ts"
      via: "cell edit dispatches"
      pattern: "dispatch"
    - from: "src/features/ratings/components/RatingModeToggle.tsx"
      to: "src/features/decision/state/draft.reducer.ts"
      via: "mode switch action"
      pattern: "mode"
---

<objective>
Implement the ratings matrix interaction layer with compact utilitarian UX, explicit missing-data handling, and non-destructive mode switching cues.

Purpose: Deliver Phase 3's user-facing matrix workflow while honoring locked trust-first UX decisions (no silent imputation, clear mode behavior, scan-friendly table interactions).
Output: Ratings route and component set for matrix editing, ghost previews, and explicit neutral-fill review/apply flow.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ratings-weights-and-coverage-integrity/03-CONTEXT.md
@.planning/phases/03-ratings-weights-and-coverage-integrity/03-RESEARCH.md
@src/routes/ratings/RatingsRoute.tsx
@src/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build compact sticky ratings matrix with dual-mode and measured-cell interactions</name>
  <files>src/features/ratings/components/RatingsStep.tsx, src/features/ratings/components/RatingsMatrix.tsx, src/features/ratings/components/RatingCell.tsx, src/features/ratings/components/RatingModeToggle.tsx, src/styles.css</files>
  <action>Create a compact spreadsheet-like ratings surface that keeps column headers and row labels sticky during scroll. Render blanks as intentional empty cells (not errors) and apply subtle tint styling only after a cell is filled. Place the `rating_1_20` mode toggle near the top-right of the ratings area with one short always-visible helper line describing numeric vs seven-level behavior. In rating cells, support direct 1-20 numeric entry and seven-level entry with fixed mapping; for measured criteria, accept raw numeric input and display derived desirability beside raw value so both are visible (RAT-07). Show inactive-mode ghost values in slightly grayed text and keep them easy to understand at a glance, not heavily de-emphasized.</action>
  <verify>`bun run lint && bun run build` succeeds; `/ratings` shows sticky matrix headers/labels, supports both rating modes, keeps blanks blank, and renders raw+derived measured values with no `0` desirability displayed.</verify>
  <done>Users can edit all matrix cell types with clear compact affordances, preserve intentional blanks, and understand dual-mode ghost values without opening extra help UI.</done>
</task>

<task type="auto">
  <name>Task 2: Add explicit Fill Missing Neutral review flow and wire RatingsRoute</name>
  <files>src/features/ratings/components/FillMissingReviewPanel.tsx, src/features/ratings/components/RatingsStep.tsx, src/routes/ratings/RatingsRoute.tsx</files>
  <action>Add a top coverage summary card at the ratings view top showing completion percentage and missing-cell count. Implement a primary explicit action `Fill all missing with Neutral (10)` that opens a review layer listing affected cells before apply. Apply changes only after explicit confirmation dispatch; cancel leaves matrix unchanged. Keep critical status/warning feedback inline in the ratings page (not toast-only). Ensure existing options/criteria prerequisite redirects remain intact in `RatingsRoute` while replacing placeholder body with the real ratings step.</action>
  <verify>`bun run lint && bun run build` succeeds; clicking fill-missing opens review UI with target count and applying fills only previously blank cells with neutral `10` while canceling performs no mutation.</verify>
  <done>Missing-data handling is deliberate and reviewable, and ratings route now hosts the real matrix workflow with locked summary-card and explicit-fill behavior.</done>
</task>

</tasks>

<verification>
Run `bun run lint && bun run build`, then manually validate `/ratings` with seeded options+criteria: scroll matrix to confirm sticky behavior, toggle mode to inspect ghost presentation, and run fill-missing review/apply/cancel paths.
</verification>

<success_criteria>
Phase 3 matrix UX is complete when users can enter ratings in both required input modes, preserve blanks until explicit action, and execute neutral-fill through a review-first trust flow.
</success_criteria>

<output>
After completion, create `.planning/phases/03-ratings-weights-and-coverage-integrity/03-02-SUMMARY.md`
</output>
