---
phase: 01-foundation-setup-and-options
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/features/decision/setup/decision.schema.ts
  - src/features/decision/setup/DecisionSetupForm.tsx
  - src/features/decision/state/decisionPrereq.ts
  - src/routes/setup/DecisionSetupRoute.tsx
autonomous: true
must_haves:
  truths:
    - "User can enter a required decision title and optional decision metadata (description, icon)."
    - "User cannot move from decision setup to options until title validation passes."
    - "When returning to the decision step, previously entered values stay populated."
  artifacts:
    - path: "src/features/decision/setup/decision.schema.ts"
      provides: "Validation rules for required title and optional metadata"
      contains: "title"
    - path: "src/features/decision/setup/DecisionSetupForm.tsx"
      provides: "Decision setup UI bound to draft state"
      contains: "description"
    - path: "src/features/decision/state/decisionPrereq.ts"
      provides: "Decision-step completion checks used by guards"
      contains: "isDecisionStepComplete"
    - path: "src/routes/setup/DecisionSetupRoute.tsx"
      provides: "Route wrapper that submits and advances only on valid data"
      contains: "navigate"
  key_links:
    - from: "src/features/decision/setup/DecisionSetupForm.tsx"
      to: "src/features/decision/state/DraftProvider.tsx"
      via: "dispatch decisionUpdated on submit/change"
      pattern: "decisionUpdated"
    - from: "src/features/decision/state/decisionPrereq.ts"
      to: "src/app/router.tsx"
      via: "route guard evaluation"
      pattern: "isDecisionStepComplete"
---

<objective>
Implement the decision setup step so users can define core decision metadata with strict gating before option authoring.

Purpose: Deliver DEC-01 and DEC-02 behavior while activating DEC-03 gating on the first wizard step.
Output: Validated decision setup form integrated with draft reducer, prerequisite logic, and route transition behavior.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build validated decision setup schema and form UI</name>
  <files>src/features/decision/setup/decision.schema.ts, src/features/decision/setup/DecisionSetupForm.tsx</files>
  <action>Implement decision setup with required `title` and optional `description`/`icon` fields using Zod-backed validation and form handling. Surface inline validation message when title is empty and keep optional fields non-blocking. Bind initial values from draft state so revisit behavior repopulates fields immediately.</action>
  <verify>Run `bun run dev`, leave title empty, attempt continue, and confirm validation blocks progression; then provide title and confirm form accepts submission.</verify>
  <done>Decision setup form enforces required title, accepts optional metadata, and restores previously entered values on revisit.</done>
</task>

<task type="auto">
  <name>Task 2: Wire decision step submission to draft state and forward gate</name>
  <files>src/features/decision/state/decisionPrereq.ts, src/routes/setup/DecisionSetupRoute.tsx, src/features/decision/setup/DecisionSetupForm.tsx</files>
  <action>On valid submission, dispatch decision draft updates and navigate to options step. Implement `isDecisionStepComplete` helper used by router guards so forward routes rely on the same completion criteria as the form submit path. Do not introduce ad hoc route checks inside unrelated components.</action>
  <verify>From a fresh state, confirm `#/setup/options` redirects back to decision until valid title is saved; after save, direct navigation to options is allowed.</verify>
  <done>Decision completion logic is centralized and consistently used by both route guards and form flow.</done>
</task>

</tasks>

<verification>
Validate DEC flow manually: start at decision step, test invalid submission, save valid data, navigate forward, then return and confirm persistence.
</verification>

<success_criteria>
DEC-01 and DEC-02 are satisfied, and DEC-03 forward gating works for the decision step without duplicating logic.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-03-SUMMARY.md`
</output>
