---
phase: 01-foundation-setup-and-options
plan: 07
type: execute
wave: 5
depends_on: ["01-03", "01-04", "01-06"]
files_modified:
  - src/features/options/components/OptionForm.tsx
  - src/features/options/components/OptionList.tsx
  - src/features/options/components/OptionsStep.tsx
  - src/routes/setup/OptionsRoute.tsx
  - src/routes/criteria/CriteriaRoute.tsx
  - src/routes/ratings/RatingsRoute.tsx
  - src/routes/results/ResultsRoute.tsx
autonomous: true
must_haves:
  truths:
    - "User can add, edit, delete, and reorder options with stable identity and optional metadata using explicit move controls."
    - "User cannot continue to criteria/ratings/results until at least two options exist."
    - "Option state persists when user navigates away from and back to setup routes."
  artifacts:
    - path: "src/features/options/components/OptionsStep.tsx"
      provides: "Option management screen with CRUD + reorder interactions"
      contains: "Add option"
    - path: "src/routes/setup/OptionsRoute.tsx"
      provides: "Options route integrated with canonical options step"
      contains: "OptionsStep"
    - path: "src/routes/ratings/RatingsRoute.tsx"
      provides: "Route-level minimum-option guard before ratings"
      contains: "hasMinimumOptions"
  key_links:
    - from: "src/features/options/components/OptionsStep.tsx"
      to: "src/features/decision/state/DraftProvider.tsx"
      via: "dispatch option actions into canonical draft state"
      pattern: "dispatch"
    - from: "src/routes/criteria/CriteriaRoute.tsx"
      to: "src/features/options/state/optionPrereq.ts"
      via: "route guard evaluates minimum-option readiness"
      pattern: "hasMinimumOptions"
---

<objective>
Deliver the option authoring experience and final minimum-option route protections so users can only progress with a valid option set.

Purpose: Complete UI and route integration after option domain and route shell foundations exist.
Output: Option CRUD/reorder components, setup route integration, and criteria/ratings/results guards backed by shared option prerequisites.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-CONTEXT.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-03-SUMMARY.md
@.planning/phases/01-foundation-setup-and-options/01-04-SUMMARY.md
@.planning/phases/01-foundation-setup-and-options/01-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build options step UI with CRUD, metadata editing, and reorder controls</name>
  <files>src/features/options/components/OptionForm.tsx, src/features/options/components/OptionList.tsx, src/features/options/components/OptionsStep.tsx, src/routes/setup/OptionsRoute.tsx</files>
  <action>Create options step controls to add, edit, delete, and reorder options while keeping stable ids and dense order from domain utilities. Implement reorder UI with up/down plus move-to-top/move-to-bottom controls as phase-1 baseline; do not add drag-and-drop in this plan. Support optional description/icon per option where icon is a simple string value with inline preview, and render from canonical draft state (no local shadow list) so navigation away and back preserves data. Keep destructive actions explicitly labeled.
  </action>
  <verify>Run `bun run dev`, add three options with mixed metadata, edit one, delete one, reorder remaining options, and confirm state updates correctly without reload.</verify>
  <done>Options setup route supports full OPT-01/OPT-02 behavior with persistent state-backed CRUD and reorder interactions.</done>
</task>

<task type="auto">
  <name>Task 2: Enforce minimum-option guards in continuation and protected routes</name>
  <files>src/features/options/components/OptionsStep.tsx, src/routes/criteria/CriteriaRoute.tsx, src/routes/ratings/RatingsRoute.tsx, src/routes/results/ResultsRoute.tsx</files>
  <action>Use shared `hasMinimumOptions` helper backed by the Zod step-gate schema (`optionsGate.schema.ts`) to block continuation from options step and to protect criteria, ratings, and results routes against deep-link bypass. Show clear actionable copy when blocked (for example, "Add at least 2 options to continue") and allow access immediately once threshold is met.</action>
  <verify>With fewer than two options, attempt navigation to `#/criteria`, `#/ratings`, and `#/results` and confirm redirects/blocking; then add a second option and confirm routes become accessible through the same Zod-backed helper path.</verify>
  <done>OPT-03 and OPT-04 are enforced through both interaction-level and route-level protections, preventing invalid forward progress.</done>
</task>

</tasks>

<verification>
Run full options flow: create/edit/delete/reorder options, verify below-threshold blocking, then confirm accessibility and persistence once two options exist.
</verification>

<success_criteria>
OPT-01, OPT-02, OPT-03, and OPT-04 are complete with stable ordered option state, optional metadata support, and minimum-two enforcement across UI and route layers.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-07-SUMMARY.md`
</output>
