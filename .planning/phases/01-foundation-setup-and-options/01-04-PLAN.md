---
phase: 01-foundation-setup-and-options
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/features/options/state/option.types.ts
  - src/features/options/state/option.actions.ts
  - src/features/options/state/optionPrereq.ts
  - src/features/options/options.schema.ts
  - src/features/options/components/OptionForm.tsx
  - src/features/options/components/OptionList.tsx
  - src/features/options/components/OptionsStep.tsx
  - src/features/options/utils/reorderOptions.ts
  - src/routes/setup/OptionsRoute.tsx
  - src/routes/criteria/CriteriaRoute.tsx
  - src/routes/ratings/RatingsRoute.tsx
  - src/routes/results/ResultsRoute.tsx
autonomous: true
must_haves:
  truths:
    - "User can add, edit, delete, and reorder options with stable identity."
    - "User can set optional description and icon for each option."
    - "User is blocked from ratings and results until at least two options exist."
    - "After creating options, user can revisit setup steps and keep option state intact."
  artifacts:
    - path: "src/features/options/components/OptionsStep.tsx"
      provides: "Option management screen with CRUD and reorder controls"
      contains: "Add option"
    - path: "src/features/options/state/option.actions.ts"
      provides: "Reducer-compatible option CRUD/reorder action creators"
      contains: "optionAdded"
    - path: "src/features/options/utils/reorderOptions.ts"
      provides: "Dense order normalization for manual reorder"
      contains: "order"
    - path: "src/features/options/state/optionPrereq.ts"
      provides: "Minimum option-count guards"
      contains: "hasMinimumOptions"
  key_links:
    - from: "src/features/options/components/OptionsStep.tsx"
      to: "src/features/decision/state/DraftProvider.tsx"
      via: "dispatch option actions to canonical draft state"
      pattern: "dispatch"
    - from: "src/features/options/state/optionPrereq.ts"
      to: "src/routes/ratings/RatingsRoute.tsx"
      via: "route-level protection for ratings"
      pattern: "hasMinimumOptions"
    - from: "src/features/options/state/optionPrereq.ts"
      to: "src/routes/results/ResultsRoute.tsx"
      via: "route-level protection for results"
      pattern: "hasMinimumOptions"
---

<objective>
Deliver full option management and enforce the minimum-option rule so users cannot continue to scoring stages with invalid option sets.

Purpose: Complete OPT-01 through OPT-04 and finalize phase-1 gating integrity around option readiness.
Output: Option CRUD/reorder UI, stable ordered option state updates, and route/action guards that require at least two options before ratings/results.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement option domain actions and validation schema</name>
  <files>src/features/options/state/option.types.ts, src/features/options/state/option.actions.ts, src/features/options/options.schema.ts, src/features/options/state/optionPrereq.ts</files>
  <action>Define option model with stable id and explicit `order` field. Add action creators and helper logic for add/edit/delete operations plus minimum-option prerequisite checks. Create schema for required option title with optional description/icon. Keep minimum option rule (`>=2`) in shared prerequisite helper so route guards and UI checks stay consistent.</action>
  <verify>Run `bun run build` and ensure option actions/types/schema compile and expose functions consumed by options UI and route guards.</verify>
  <done>Option business rules are centralized and reusable across interaction and routing layers.</done>
</task>

<task type="auto">
  <name>Task 2: Build options step UI for CRUD and metadata editing</name>
  <files>src/features/options/components/OptionForm.tsx, src/features/options/components/OptionList.tsx, src/features/options/components/OptionsStep.tsx, src/routes/setup/OptionsRoute.tsx</files>
  <action>Create options step with controls to add new options, edit existing options, and delete options. Include optional description and icon inputs per option. Render options from canonical draft state (no local shadow list) so data survives navigation. Keep destructive action labels explicit to avoid accidental delete confusion.</action>
  <verify>Run `bun run dev`, add three options with mixed metadata, edit one, delete one, and confirm list/state updates correctly without page reload.</verify>
  <done>Users can perform full option CRUD, including optional metadata, and see state persist when leaving and returning to the step.</done>
</task>

<task type="auto">
  <name>Task 3: Add manual reorder and enforce >=2 guards at UI and route levels</name>
  <files>src/features/options/utils/reorderOptions.ts, src/features/options/components/OptionList.tsx, src/features/options/components/OptionsStep.tsx, src/routes/criteria/CriteriaRoute.tsx, src/routes/ratings/RatingsRoute.tsx, src/routes/results/ResultsRoute.tsx</files>
  <action>Implement manual reorder behavior (drag-and-drop with `@dnd-kit/sortable` or explicit move controls) that keeps stable ids and normalizes to dense order values after each move. Enforce minimum option count in both options-step continuation controls and route-level guards for criteria/ratings/results. Show actionable validation copy when blocked (for example, "Add at least 2 options to continue").</action>
  <verify>With fewer than two options, attempt to navigate to `#/criteria`, `#/ratings`, and `#/results` and confirm redirects/blocking. With two or more options, confirm those routes become accessible and reordered list persists.</verify>
  <done>OPT-03 and OPT-04 are enforced through both interaction-level and structural routing protections, preventing bypass via deep links.</done>
</task>

</tasks>

<verification>
Run full options flow: create/edit/delete/reorder options, verify guard behavior below and above the 2-option threshold, and confirm route protection cannot be bypassed by URL.
</verification>

<success_criteria>
OPT-01, OPT-02, OPT-03, and OPT-04 are complete with stable ordered option state, optional metadata support, and dual-layer (`UI + route`) minimum-option enforcement.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-04-SUMMARY.md`
</output>
