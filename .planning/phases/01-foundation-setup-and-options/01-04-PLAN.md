---
phase: 01-foundation-setup-and-options
plan: 04
type: execute
wave: 4
depends_on: ["01-02"]
files_modified:
  - src/features/options/state/option.types.ts
  - src/features/options/state/option.actions.ts
  - src/features/options/state/optionPrereq.ts
  - src/features/options/options.schema.ts
  - src/features/options/utils/reorderOptions.ts
  - src/features/decision/state/draft.reducer.ts
autonomous: true
must_haves:
  truths:
    - "Option rules are centralized before UI wiring, including stable identity and deterministic ordering."
    - "Option validity and minimum-count prerequisites are defined once and reusable by both route guards and UI controls."
  artifacts:
    - path: "src/features/options/state/option.actions.ts"
      provides: "Reducer-compatible option CRUD/reorder action creators"
      contains: "optionAdded"
    - path: "src/features/options/options.schema.ts"
      provides: "Validation rules for required option title and optional metadata"
      contains: "title"
    - path: "src/features/options/utils/reorderOptions.ts"
      provides: "Dense order normalization for manual reorder"
      contains: "order"
    - path: "src/features/options/state/optionPrereq.ts"
      provides: "Minimum option-count guards"
      contains: "hasMinimumOptions"
  key_links:
    - from: "src/features/options/state/option.actions.ts"
      to: "src/features/decision/state/draft.reducer.ts"
      via: "reducer applies option action payloads to canonical draft state"
      pattern: "option"
    - from: "src/features/options/state/optionPrereq.ts"
      to: "src/features/options/state/option.types.ts"
      via: "minimum-count checks evaluate canonical option collection"
      pattern: "hasMinimumOptions"
---

<objective>
Implement option-domain primitives so UI and route layers can enforce a single source of truth for option validity and minimum-count readiness.

Purpose: Separate option business rules from component wiring to keep execution scope focused and reduce context strain.
Output: Typed option model, action helpers, validation schema, reorder utility, and reducer integration points.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define typed option model, validation schema, and prerequisite helpers</name>
  <files>src/features/options/state/option.types.ts, src/features/options/options.schema.ts, src/features/options/state/optionPrereq.ts</files>
  <action>Define option model with stable id and explicit `order` field plus optional metadata fields used in phase-1 UX. Create schema for required option title with optional description/icon. Keep minimum-option rule (`>=2`) in shared prerequisite helper so route guards and UI continuation checks reuse identical logic.</action>
  <verify>Run `bun run build` and ensure option actions/types/schema compile and expose functions consumed by options UI and route guards.</verify>
  <done>Option data contract and prerequisite logic are centralized and ready for component and router integration.</done>
</task>

<task type="auto">
  <name>Task 2: Implement reusable option action creators and reducer integration</name>
  <files>src/features/options/state/option.actions.ts, src/features/options/utils/reorderOptions.ts, src/features/decision/state/draft.reducer.ts</files>
  <action>Create typed action creators for add/edit/delete/reorder operations that preserve stable ids and normalize order after mutations. Implement reducer cases that apply these actions immutably against canonical draft state. Do not wire route components in this plan; keep integration points focused on domain/state layers only.</action>
  <verify>Run `bun run build` and verify reducer handles option action payloads without type assertions or `any` casts.</verify>
  <done>Canonical draft reducer can execute option CRUD/reorder transitions using shared typed action payloads and order-normalization helper.</done>
</task>

</tasks>

<verification>
Run `bun run build` and confirm option state primitives compile cleanly and are consumable by upcoming UI/route integration plan.
</verification>

<success_criteria>
Option domain foundations for OPT-01 through OPT-04 are in place with stable ordering semantics, reusable validation, and minimum-option prerequisite helpers ready for UI/router consumption.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-04-SUMMARY.md`
</output>
