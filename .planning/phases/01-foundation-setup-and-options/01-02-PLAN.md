---
phase: 01-foundation-setup-and-options
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/App.tsx
  - src/app/router.tsx
  - src/features/decision/state/draft.types.ts
  - src/features/decision/state/draft.reducer.ts
  - src/features/decision/state/draft.storage.ts
  - src/features/decision/state/DraftProvider.tsx
  - src/features/decision/state/decisionPrereq.ts
  - src/features/options/state/optionPrereq.ts
  - src/routes/setup/DecisionSetupRoute.tsx
  - src/routes/setup/OptionsRoute.tsx
  - src/routes/criteria/CriteriaRoute.tsx
  - src/routes/ratings/RatingsRoute.tsx
  - src/routes/results/ResultsRoute.tsx
autonomous: true
must_haves:
  truths:
    - "User can move through a route-per-step wizard while route guards enforce prerequisites."
    - "User can revisit completed setup steps without losing previously entered draft data."
    - "Ratings and results routes are structurally guardable from centralized state."
  artifacts:
    - path: "src/features/decision/state/draft.reducer.ts"
      provides: "Canonical decision draft state transitions"
      contains: "decisionUpdated"
    - path: "src/features/decision/state/DraftProvider.tsx"
      provides: "Reducer/context provider with persistence hydration"
      contains: "useReducer"
    - path: "src/app/router.tsx"
      provides: "Hash-routed step definitions and guard wrappers"
      contains: "/setup/decision"
    - path: "src/features/options/state/optionPrereq.ts"
      provides: "Option-count gate helpers"
      contains: "minimum"
  key_links:
    - from: "src/app/router.tsx"
      to: "src/features/decision/state/DraftProvider.tsx"
      via: "route elements consume provider state"
      pattern: "DraftProvider"
    - from: "src/app/router.tsx"
      to: "src/features/decision/state/decisionPrereq.ts"
      via: "guard checks before navigation"
      pattern: "decisionPrereq"
    - from: "src/app/router.tsx"
      to: "src/features/options/state/optionPrereq.ts"
      via: "guard checks for ratings/results access"
      pattern: "optionPrereq"
---

<objective>
Establish the wizard architecture and centralized draft state so setup data persists and route gating works consistently across all phase-1 screens.

Purpose: Create the structural backbone for DEC-03 and DEC-04 before implementing detailed step UIs.
Output: Decision draft reducer/provider with persistence adapter, step routes, and prerequisite guard functions wired into routing.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create canonical decision draft state and persistence adapter</name>
  <files>src/features/decision/state/draft.types.ts, src/features/decision/state/draft.reducer.ts, src/features/decision/state/draft.storage.ts, src/features/decision/state/DraftProvider.tsx</files>
  <action>Define a single `DecisionDraft` model containing decision metadata and ordered options with stable ids. Implement reducer actions for decision and option mutations (`decisionUpdated`, `optionAdded`, `optionUpdated`, `optionDeleted`, `optionsReordered`) and keep updates immutable. Add storage hydrate/save helpers so completed-step revisit and refresh do not clear in-progress draft state.</action>
  <verify>Run `bun run build` and confirm reducer/provider compile with typed actions and no `any` fallbacks.</verify>
  <done>One provider owns all phase-1 draft data and supports round-trip hydration without data loss.</done>
</task>

<task type="auto">
  <name>Task 2: Implement route-per-step wizard shell and placeholder step routes</name>
  <files>src/app/App.tsx, src/app/router.tsx, src/routes/setup/DecisionSetupRoute.tsx, src/routes/setup/OptionsRoute.tsx, src/routes/criteria/CriteriaRoute.tsx, src/routes/ratings/RatingsRoute.tsx, src/routes/results/ResultsRoute.tsx</files>
  <action>Create hash-routed step paths for setup, criteria, ratings, and results with lightweight placeholder screens. Wire `App` to router + provider. Keep routes explicit and stable so later plans can replace placeholder route bodies without changing global navigation contracts.</action>
  <verify>Run `bun run dev`, navigate through each hash route, and confirm all defined step paths render (placeholder content is acceptable at this stage).</verify>
  <done>Every phase-1 step has a routable page in hash mode and app-level provider wiring is active.</done>
</task>

<task type="auto">
  <name>Task 3: Add centralized prerequisite helpers and route guard integration points</name>
  <files>src/features/decision/state/decisionPrereq.ts, src/features/options/state/optionPrereq.ts, src/app/router.tsx</files>
  <action>Create dedicated guard helpers for decision setup completeness and option minimum requirements (`>=2`). Integrate guard checks in route wrappers/redirection logic, not only in button disabled states, so direct URL access cannot bypass prerequisites.</action>
  <verify>With an empty draft state, attempt direct navigation to `#/ratings` and `#/results` and confirm router redirects to prerequisite steps instead of rendering protected pages.</verify>
  <done>Guard hooks exist at route level and are ready for concrete DEC/OPT rules from the next plans.</done>
</task>

</tasks>

<verification>
Validate end-to-end skeleton behavior: route graph loads, draft provider hydrates/saves, and protected routes redirect when prerequisites fail.
</verification>

<success_criteria>
DEC-03 and DEC-04 architecture is in place: step routes are explicit, forward movement can be guarded, and revisiting completed steps preserves entered draft context.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-02-SUMMARY.md`
</output>
