---
phase: 01-foundation-setup-and-options
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/features/decision/state/draft.types.ts
  - src/features/decision/state/draft.reducer.ts
  - src/features/decision/state/draft.storage.ts
  - src/features/decision/state/DraftProvider.tsx
  - src/features/decision/state/decisionPrereq.ts
autonomous: true
must_haves:
  truths:
    - "Draft decision data persists across refresh and step revisits for logged-out users via localStorage."
    - "User can revisit completed setup steps without losing previously entered draft data."
    - "Decision-step readiness can be evaluated from centralized state without duplicating checks in route components."
  artifacts:
    - path: "src/features/decision/state/draft.reducer.ts"
      provides: "Canonical decision draft state transitions"
      contains: "decisionUpdated"
    - path: "src/features/decision/state/DraftProvider.tsx"
      provides: "Reducer/context provider with persistence hydration"
      contains: "useReducer"
    - path: "src/features/decision/state/decisionPrereq.ts"
      provides: "Decision completion gate helper for route integration"
      contains: "isDecisionStepComplete"
  key_links:
    - from: "src/features/decision/state/DraftProvider.tsx"
      to: "src/features/decision/state/draft.storage.ts"
      via: "hydrate on init and persist on state updates"
      pattern: "hydrate"
    - from: "src/features/decision/state/decisionPrereq.ts"
      to: "src/features/decision/state/draft.types.ts"
      via: "type-safe completion checks against canonical draft shape"
      pattern: "DecisionDraft"
---

<objective>
Establish the centralized draft-state foundation with persistence and reusable decision prerequisites.

Purpose: Isolate data ownership and prerequisite logic before route-shell wiring so later plans can integrate guards without reworking state contracts.
Output: Decision draft reducer/provider with storage hydration and decision prerequisite helper utilities.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup-and-options/01-CONTEXT.md
@.planning/phases/01-foundation-setup-and-options/01-RESEARCH.md
@.planning/phases/01-foundation-setup-and-options/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create canonical decision draft state and persistence adapter</name>
  <files>src/features/decision/state/draft.types.ts, src/features/decision/state/draft.reducer.ts, src/features/decision/state/draft.storage.ts, src/features/decision/state/DraftProvider.tsx</files>
  <action>Define a single `DecisionDraft` model for decision metadata plus option collection placeholders, then implement reducer transitions for decision metadata updates and draft initialization/reset. Add `localStorage` hydrate/save helpers so logged-out users keep in-progress draft state across refresh and completed-step revisits. Keep storage logic in dedicated adapter helpers rather than embedding persistence in route files.</action>
  <verify>Run `bun run build` and confirm reducer/provider compile with typed actions and no `any` fallbacks.</verify>
  <done>One provider owns phase-1 draft data and supports round-trip hydration without data loss.</done>
</task>

<task type="auto">
  <name>Task 2: Add reusable decision prerequisite helper for guard wiring</name>
  <files>src/features/decision/state/decisionPrereq.ts, src/features/decision/state/draft.types.ts</files>
  <action>Create dedicated helper(s) that determine whether the decision setup step is complete from canonical draft state (required title present, optional metadata non-blocking). Keep these checks pure and framework-agnostic so router guards and setup route submission can share one source of truth.</action>
  <verify>Run `bun run build` and confirm prerequisite helpers export typed functions consumed without circular imports.</verify>
  <done>Decision prerequisite logic exists as standalone typed helpers ready for route guard integration in the next plan.</done>
</task>

</tasks>

<verification>
Validate state foundation behavior: draft provider hydrates/saves cleanly and prerequisite helpers evaluate completion from canonical state.
</verification>

<success_criteria>
Draft persistence and decision prerequisite foundations are in place so route-shell and step plans can enforce gating without duplicating state logic.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup-and-options/01-02-SUMMARY.md`
</output>
