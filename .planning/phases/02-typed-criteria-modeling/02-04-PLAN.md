---
phase: 02-typed-criteria-modeling
plan: 04
type: execute
wave: 3
depends_on:
  - 02-02
  - 02-03
files_modified:
  - src/features/criteria/components/CriteriaStep.tsx
  - src/routes/criteria/CriteriaRoute.tsx
  - src/routes/ratings/RatingsRoute.tsx
  - src/routes/results/ResultsRoute.tsx
autonomous: true
must_haves:
  truths:
    - "User can complete criteria setup from the Criteria route and proceed to Ratings only when criteria requirements are met."
    - "User is redirected with recovery messaging when attempting Ratings/Results without required criteria."
    - "Criteria route surfaces template, editor, deletion safeguards, and type semantics in one coherent flow."
  artifacts:
    - path: "src/routes/criteria/CriteriaRoute.tsx"
      provides: "Integrated criteria authoring route with next-step navigation"
      contains: "Continue to ratings"
    - path: "src/routes/ratings/RatingsRoute.tsx"
      provides: "Criteria prerequisite guard before ratings matrix access"
      contains: "Navigate"
    - path: "src/routes/results/ResultsRoute.tsx"
      provides: "Criteria prerequisite guard before results access"
      contains: "Navigate"
  key_links:
    - from: "src/routes/criteria/CriteriaRoute.tsx"
      to: "src/features/criteria/components/CriteriaStep.tsx"
      via: "step composition"
      pattern: "<CriteriaStep"
    - from: "src/routes/ratings/RatingsRoute.tsx"
      to: "src/features/criteria/state/criterionPrereq.ts"
      via: "route guard"
      pattern: "hasMinimumCriteria"
    - from: "src/routes/results/ResultsRoute.tsx"
      to: "src/features/criteria/state/criterionPrereq.ts"
      via: "route guard"
      pattern: "hasMinimumCriteria"
---

<objective>
Integrate criteria authoring into the wizard route flow and enforce criteria prerequisites before ratings/results access.

Purpose: Complete Phase 2 user-facing workflow so typed criteria are fully authored before ratings entry, with deep-link-safe guard behavior matching existing step architecture.
Output: Criteria route integration plus ratings/results guard updates using shared criteria gate helper and recovery messaging.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-typed-criteria-modeling/02-CONTEXT.md
@.planning/phases/01-foundation-setup-and-options/01-06-SUMMARY.md
@.planning/phases/01-foundation-setup-and-options/01-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire complete criteria authoring experience into the criteria route</name>
  <files>src/routes/criteria/CriteriaRoute.tsx, src/features/criteria/components/CriteriaStep.tsx</files>
  <action>Replace the criteria placeholder route with the full criteria step experience from prior plans. Ensure users can add/edit/delete/reorder criteria, use templates (Recommended/Measured with confirm/customize), switch compact/rich list views, and complete typed configuration through dedicated editor panel/modal. Keep progression controls explicit (`Back to options`, `Continue to ratings`) and gate continue behavior through shared `hasMinimumCriteria` helper. Ensure helper copy reinforces that criteria are converted into 1-20 desirability where higher is better.</action>
  <verify>`bun run build && bun run lint` succeeds; `/criteria` renders full criteria workflow; continue button blocks when criteria gate fails and enables when valid criteria exist.</verify>
  <done>Criteria route is fully functional (not placeholder) and users can reach Ratings only after creating valid criteria with locked semantics intact.</done>
</task>

<task type="auto">
  <name>Task 2: Enforce criteria prerequisites on ratings and results routes with recovery messaging</name>
  <files>src/routes/ratings/RatingsRoute.tsx, src/routes/results/ResultsRoute.tsx</files>
  <action>Add criteria prerequisite checks to ratings and results routes using `hasMinimumCriteria` from criteria prereq helper. Preserve existing options prerequisite logic, then layer criteria guard so deep links cannot bypass required setup. Redirect blocked users back to `/criteria` with explicit guard message describing the missing requirement and next action. Keep guard contract deterministic and aligned with schema-backed criteria gate helper.</action>
  <verify>`bun run build && bun run lint` succeeds; direct navigation to `/ratings` or `/results` with no criteria redirects to `/criteria` and displays recovery message.</verify>
  <done>Deep-link safety now covers criteria readiness as well as options readiness; downstream steps are inaccessible until criteria setup is complete.</done>
</task>

</tasks>

<verification>
Run `bun run build && bun run lint`, then test wizard flow `/setup/options -> /criteria -> /ratings` and direct URL access to `/ratings` and `/results` to confirm prerequisites and redirect messaging work as expected.
</verification>

<success_criteria>
Phase 2 flow is complete when criteria authoring is route-integrated, downstream steps are criteria-gated, and users consistently see desirability-first semantics before entering ratings.
</success_criteria>

<output>
After completion, create `.planning/phases/02-typed-criteria-modeling/02-04-SUMMARY.md`
</output>
