---
phase: 02-typed-criteria-modeling
plan: 02
type: execute
wave: 2
depends_on:
  - 02-01
files_modified:
  - src/features/criteria/components/CriteriaStep.tsx
  - src/features/criteria/components/CriteriaList.tsx
  - src/features/criteria/components/CriteriaRow.tsx
  - src/features/criteria/components/CriteriaDeleteModal.tsx
  - src/features/criteria/components/CriteriaUndoToast.tsx
autonomous: true
must_haves:
  truths:
    - "User can add/edit/delete/reorder criteria with a required title and optional description."
    - "Criteria list defaults to compact rows and can switch to a richer detail row mode."
    - "User can multi-select criteria for one confirmation-based bulk delete and immediate undo."
  artifacts:
    - path: "src/features/criteria/components/CriteriaStep.tsx"
      provides: "Reducer-backed criteria authoring orchestration and continue gating"
      contains: "hasMinimumCriteria"
    - path: "src/features/criteria/components/CriteriaList.tsx"
      provides: "Criteria row rendering with selection and reorder controls"
      contains: "Move up"
    - path: "src/features/criteria/components/CriteriaDeleteModal.tsx"
      provides: "Single and multi-delete confirmation with names preview"
      contains: "Delete"
  key_links:
    - from: "src/features/criteria/components/CriteriaStep.tsx"
      to: "src/features/criteria/state/criterion.actions.ts"
      via: "dispatch"
      pattern: "dispatch\(criterion"
    - from: "src/features/criteria/components/CriteriaStep.tsx"
      to: "src/features/criteria/components/CriteriaUndoToast.tsx"
      via: "delete undo payload"
      pattern: "undo"
---

<objective>
Implement the core criteria authoring interactions and list management workflow with low-friction behavior and explicit destructive safeguards.

Purpose: Deliver CRT-01 baseline behavior and locked UX decisions for compact-by-default authoring, simple reordering, and safe deletion before template/editor enhancements are integrated.
Output: Criteria step/list components with reducer-backed CRUD, compact vs rich row toggle, selection mode multi-delete confirmation, and undo toast.
</objective>

<execution_context>
@C:/Users/aaron/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/aaron/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-typed-criteria-modeling/02-CONTEXT.md
@.planning/phases/01-foundation-setup-and-options/01-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build criteria list surface with compact default, rich toggle, and up/down reordering</name>
  <files>src/features/criteria/components/CriteriaList.tsx, src/features/criteria/components/CriteriaRow.tsx, src/features/criteria/components/CriteriaStep.tsx</files>
  <action>Create criteria list rendering with compact row mode as default (title + type + mapping status) and a user toggle to richer row detail mode. Keep toggle placement practical and scan-friendly per discretion. Add add/edit entry points, selection mode toggles, and reorder controls limited to up/down buttons only (explicitly no drag-drop). Wire all list interactions to reducer-backed criteria actions from DraftProvider state; avoid component-local shadow arrays. Continue button must use `hasMinimumCriteria` to gate progression and provide clear helper copy when blocked.</action>
  <verify>`bun run build && bun run lint` succeeds; list defaults compact; row detail toggle changes rendering mode; reordering controls expose only up/down actions.</verify>
  <done>User can manage criterion order and visibility mode from one reducer-backed list, with compact scanning by default and no out-of-scope drag-and-drop behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Implement destructive-delete safeguards with single/multi confirmation and undo toast</name>
  <files>src/features/criteria/components/CriteriaDeleteModal.tsx, src/features/criteria/components/CriteriaUndoToast.tsx, src/features/criteria/components/CriteriaStep.tsx</files>
  <action>Implement confirmation modal flow for single delete and multi-delete from selection mode. For multi-delete, show one modal containing delete count and names preview before confirming. On confirm, dispatch delete action(s) and show an undo toast that restores the exact deleted criteria set (including order normalization). Keep deletion copy practical and non-alarmist while clearly indicating permanence if undo is ignored. Ensure delete confirmation runs through one modal component path for both single and multi cases.</action>
  <verify>`bun run build && bun run lint` succeeds; deleting one criterion requires confirmation; multi-delete confirmation shows count + names; undo restores deleted criteria and closes toast.</verify>
  <done>Deletion is deliberate and recoverable in-session: users can safely delete one or many criteria with explicit preview and immediate undo option.</done>
</task>

</tasks>

<verification>
Run `bun run build && bun run lint`, then exercise criteria step interactions in dev mode to confirm compact default rendering, selection mode bulk deletion flow, and undo restoration without route or state inconsistencies.
</verification>

<success_criteria>
CRT-01 interaction baseline is achieved: criteria CRUD/reorder workflows are reducer-owned, scan-friendly, and protected by confirmation + undo behavior matching locked UX decisions.
</success_criteria>

<output>
After completion, create `.planning/phases/02-typed-criteria-modeling/02-02-SUMMARY.md`
</output>
